<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/css/academicons.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/jtd.css"> <link rel=stylesheet  href="/css/my.css"> <script src="https://kit.fontawesome.com/14ae11cdce.js" crossorigin=anonymous ></script> <link rel=apple-touch-icon  sizes=180x180  href="/assets/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="/assets/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="/assets/favicon-16x16.png"> <link rel=icon  href="/assets/favicon.ico"> <link rel=manifest  href="/site.webmanifest"> <style> /* #148 wrap long header */ .franklin-content a.header-anchor, .franklin-toc li a { word-wrap: break-word; white-space: normal; } </style> <title>Jack Shannon | Looking for Santander Cycles with Shortcuts</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/" class=title > jbshannon </a> </div> <div class=about > <img src="/assets/gh.jpg" style="border-radius: 50%"> </div> <label for=show-menu  class=show-menu ><i class="fa-solid fa-bars"></i></label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "> <a href="/" class="menu-list-link ">Home</a> <li class="menu-list-item "> <a href="/research" class="menu-list-link ">Research</a> <li class="menu-list-item "> <a href="/teaching/" class="menu-list-link ">Teaching</a> <ul class="menu-list-child-list "> <li class="menu-list-item "> <a href="/teaching/EC313" class="menu-list-link ">EC313</a> <li class="menu-list-item "> <a href="/teaching/EC486" class="menu-list-link ">EC486</a> </ul> <li class="menu-list-item "> <a href="/blog/" class="menu-list-link active">Blog</a> </ul> </div> <div class=footer > <a href="https://github.com/jbshannon"> <i class="fab fa-github"></i> <span class=username >@jbshannon</span> </a> <br> <a href="https://twitter.com/jbsecon"> <i class="fab fa-twitter"></i> <span class=username >@jbsecon</span> </a> </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="https://github.com/jbshannon" class=social > <i class="fa-brands fa-github"></i> </a> <a id=twitter  href="https://twitter.com/jbsecon" class=social > <i class="fa-brands fa-twitter"></i> </a> <a id=twitter  href="https://www.lse.ac.uk/economics/people/research-students/john-shannon" class=social > <i class="fa-solid fa-graduation-cap"></i> </a> </div> <div class=franklin-content > <h1 id=using_shortcuts_to_check_santander_cycles ><a href="#using_shortcuts_to_check_santander_cycles" class=header-anchor >Using Shortcuts to Check Santander Cycles</a></h1> <p>TfL&#39;s Santander Cycles have been my favorite way to get around central London since I first tried them during Covid lockdowns. The annual subscription &#40;with a student discount&#33;&#41; means I can make short journeys faster than on a bus, sometimes even faster than on the tube. But I had one problem when making the journey into LSE â€“ often I would arrive to find every docking station completely full, meaning I had to pull out my phone to search for the nearest available docking space. That&#39;s not the most elegant thing to do when you&#39;re pulled over on the side of a busy road straddling a bike, especially when the app turns out to be frozen. I wanted to find an easier way to check for empty spaces near my destination.</p> <p>In this post I show how to get the number of bikes and empty docks at any station using the <a href="https://tfl.gov.uk/info-for/open-data-users/unified-api#on-this-page-1">TfL API</a> and then show the steps to do this in the Shortcuts app. The Shortcut can be run from the Shortcuts app, from your iPhone or iPad&#39;s home screen as a standalone app or within a widget, from Siri, from your Mac&#39;s task bar, or even from a complication on your Apple Watch face. If you&#39;d like to use these shortcuts yourself, here are the iCloud sharing links:</p> <ul> <li><p><a href="https://www.icloud.com/shortcuts/c09620f69b804c62a11f2c8bb4b2b5ef">Get Santander Cycle Feed</a></p> <li><p><a href="https://www.icloud.com/shortcuts/d02693b7d1204478a7cf881c6c4de5db">Check Bikes Example</a></p> </ul> <h2 id=the_tfl_api ><a href="#the_tfl_api" class=header-anchor >The TfL API</a></h2> <p>TfL has developed a <a href="https://tfl.gov.uk/info-for/open-data-users/unified-api#on-this-page-1">unified API</a> that provides real-time information about its services to anyone with the appropriate programming know-how. The API provides a <a href="https://api.tfl.gov.uk/swagger/ui/index.html?url&#61;/swagger/docs/v1#&#33;/BikePoint/BikePoint_GetAll"><code>BikePoint</code></a> endpoint that returns information about all docking stations. Let&#39;s pull this information and see what the JSON data for a single bikepoint looks like:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> HTTP, JSON3
r = HTTP.get(<span class=hljs-string >&quot;https://api.tfl.gov.uk/BikePoint&quot;</span>)
bikepoints = r.body |&gt; <span class=hljs-built_in >String</span> |&gt; JSON3.read
bp = first(bikepoints)
JSON3.pretty(bp)</code></pre> <pre><code class="plaintext hljs">ArgumentError: Package HTTP not found in current path.
- Run `import Pkg; Pkg.add(&quot;HTTP&quot;)` to install the HTTP package.
</code></pre> <p>There&#39;s a lot going on here, but the important things we observe are:</p> <ul> <li><p>The unique <code>id</code> field will let us query the API for just this station</p> <li><p>The <code>commonName</code> field gives the name of the station as it appears in the app</p> <li><p>The information we want &#40;the number of bikes/E-bikes and empty docking points&#41; live inside the <code>additionalProperties</code> field</p> </ul> <p>The structure of the <code>additionalProperties</code> field is a bit odd in that the keys are actually values themselves, so we can&#39;t access them by name. Let&#39;s get the index of each key-value pair:</p> <pre><code class="julia hljs"><span class=hljs-keyword >for</span> (i, property) <span class=hljs-keyword >in</span> enumerate(bp.additionalProperties)
    println(<span class=hljs-string >&quot;(<span class=hljs-variable >$i</span>) &quot;</span>, property.key, <span class=hljs-string >&quot; =&gt; &quot;</span>, property.value)
<span class=hljs-keyword >end</span></code></pre> <pre><code class="plaintext hljs">UndefVarError: bp not defined
</code></pre> <p>So the indices we care about are <code>&#91;8, 10, 11&#93;</code>.</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> print_bike_point(bp)
    println(<span class=hljs-string >&quot;<span class=hljs-subst >$(bp.commonName)</span> (id: <span class=hljs-subst >$(bp.id)</span>)&quot;</span>)
    println(<span class=hljs-string >&quot;Number of standard bikes: <span class=hljs-subst >$(bp.additionalProperties[<span class=hljs-number >10</span>].value)</span>&quot;</span>)
    println(<span class=hljs-string >&quot;Number of E-bikes: <span class=hljs-subst >$(bp.additionalProperties[<span class=hljs-number >11</span>].value)</span>&quot;</span>)
    println(<span class=hljs-string >&quot;Number of empty docks: <span class=hljs-subst >$(bp.additionalProperties[<span class=hljs-number >8</span>].value)</span>&quot;</span>)
<span class=hljs-keyword >end</span>

print_bike_point(bp)</code></pre> <pre><code class="plaintext hljs">UndefVarError: bp not defined
</code></pre> <p>Now that we know how to get the information we want for any station, we need to find the IDs of the stations we want to include in our search. The API provides a <code>BikePoint/Search</code> endpoint where we can search stations by name:</p> <pre><code class="julia hljs">r = HTTP.get(
    <span class=hljs-string >&quot;https://api.tfl.gov.uk/BikePoint/Search&quot;</span>;
    query=[<span class=hljs-string >&quot;query&quot;</span> =&gt; <span class=hljs-string >&quot;Lincoln&#x27;s Inn Fields&quot;</span>]
)
<span class=hljs-meta >@show</span> search_results = r.body |&gt; <span class=hljs-built_in >String</span> |&gt; JSON3.read</code></pre> <pre><code class="plaintext hljs">UndefVarError: HTTP not defined
</code></pre> <p>Now that we have the ID, we can use the <code>BikePoint/&#123;id&#125;</code> endpoint to request data for that bike point only:</p> <pre><code class="julia hljs">base_url = <span class=hljs-string >&quot;https://api.tfl.gov.uk/BikePoint/BikePoints_&quot;</span>
station_id = <span class=hljs-string >&quot;809&quot;</span>
r = HTTP.get(base_url * station_id)
r.body |&gt; <span class=hljs-built_in >String</span> |&gt; JSON3.read |&gt; print_bike_point</code></pre> <pre><code class="plaintext hljs">UndefVarError: HTTP not defined
</code></pre> <h2 id=accessing_the_api_through_shortcuts ><a href="#accessing_the_api_through_shortcuts" class=header-anchor >Accessing the API through Shortcuts</a></h2> <p>Apple&#39;s Shortcuts app is able to read JSON objects as dictionaries, so with a little manipulation &#40;and a lot of dragging and dropping&#41; we can replicate the results of the above API call. I wanted to be able to run my Shortcut for multiple destinations &#40;e.g. work, home, etc.&#41;, so I separated the Shortcut into two: an inner Shortcut to receive a list of stations and return a list of messages, and an outer Shortcut to pass a list of stations to the inner Shortcut and display the results as an alert.</p> <h3 id=the_inner_shortcut_accessing_the_api ><a href="#the_inner_shortcut_accessing_the_api" class=header-anchor >The Inner Shortcut: Accessing the API</a></h3> <p>The steps to follow are:</p> <ol> <li><p>Set the base URL</p> <li><p>Add the station ID to the URL</p> <li><p>Request the data from the API</p> <li><p>Parse the response into a dictionary</p> <li><p>Extract the station&#39;s <code>commonName</code></p> <li><p>Extract the <code>additionalProperties</code> as a list</p> <ol> <li><p>Get the number of standard bikes at index 10</p> <li><p>Get the number of E-bikes at index 11</p> <li><p>Get the number of empty docks at index 8</p> </ol> <li><p>Combine the results into text that can be displayed</p> </ol> <h4 id=setting_the_base_url ><a href="#setting_the_base_url" class=header-anchor >Setting the Base URL</a></h4> <p><img src="https://i.imgur.com/pxozQqv.jpg" alt="Setting the base URL" /></p> <h4 id=constructing_the_api_call ><a href="#constructing_the_api_call" class=header-anchor >Constructing the API Call</a></h4> <p>We begin looping over every item in the list:</p> <p><img src="https://i.imgur.com/9xawuLo.jpg" alt="Constructing the API Call" /></p> <h4 id=parsing_the_api_response ><a href="#parsing_the_api_response" class=header-anchor >Parsing the API Response</a></h4> <p><img src="https://i.imgur.com/TOyDXSe.jpg" alt="Parsing the API Response" /></p> <h4 id=getting_the_station_name ><a href="#getting_the_station_name" class=header-anchor >Getting the Station Name</a></h4> <p><img src="https://i.imgur.com/IDb1pZp.jpg" alt="Getting the Station Name" /></p> <h4 id=getting_the_station_properties ><a href="#getting_the_station_properties" class=header-anchor >Getting the Station Properties</a></h4> <p>Because we want to access the <code>additionalProperties</code> dictionary multiple times, we have to create a variable for it:</p> <p><img src="https://i.imgur.com/Fl5qHd5.jpg" alt="Getting the Station Properties" /></p> <p>Scripting functionality in Shortcuts is fairly limited, so I had to hardcode the next three steps rather than using something like a loop:</p> <p><img src="https://i.imgur.com/2NKDqoe.jpg" alt=Imgur  /></p> <p><img src="https://i.imgur.com/w3SphGm.jpg" alt=Imgur  /></p> <p><img src="https://i.imgur.com/TPAqt0b.jpg" alt=Imgur  /></p> <h4 id=constructing_the_output ><a href="#constructing_the_output" class=header-anchor >Constructing the Output</a></h4> <p>Now I combine everything into a single message. I leave an emtpy line at the top so that when the Shortcut returns multiple stations they are separated by a space. I chose to represent each number with an emoji since it saves visual space, allowing all three numbers to fit into one line on my watch.</p> <p>When you tell Siri to run the shortcut, the results are read aloud. This can sound pretty confusing with the output text I currently have written, but you can tweak the text output to make it sound more natural when spoken if you prefer to run the Shortcut through Siri.</p> <p><img src="https://i.imgur.com/s6tX0Ng.jpg" alt="Constructing the Output" /></p> <h3 id=the_outer_shortcut_making_a_list_of_stations ><a href="#the_outer_shortcut_making_a_list_of_stations" class=header-anchor >The Outer Shortcut: Making a List of Stations</a></h3> <p>Constructing a list of stations you want to be included in the Shortcut can be a bit difficult, depending on how you approach it. I used the map in the mobile app to find the names of the stations I wanted to include and looked up the ID for each station. You can do this using the API, but I found it quicker to look up the <a href="https://tfl.gov.uk/tfl/syndication/feeds/cycle-hire/livecyclehireupdates.xml">XML feed</a> and search for the station name using my browser &#40;the number you need for the shortcut is the <code>&lt;id&gt;</code> field, not <code>&lt;terminalName&gt;</code>&#41;.</p> <p>Once we&#39;ve done that, the Shortcut itself is very simple:</p> <p><img src="https://i.imgur.com/T4x9Xgg.jpg" alt="Outer Shortcut" /></p> <p>Running the Shortcut produces a native alert:</p> <p><img src="https://i.imgur.com/3ehTuKz.jpg" alt="Outer Shortcut Result" /></p> <p>The great advantage of this Shortcut is that you can get these results are incredibly accessible because Shortcuts are built into iOS. You can add the Shortcut to your home screen as an icon, run it from a widget, access it from your Mac&#39;s task bar, or even run it from a complication on your watch face:</p> <p><img src="https://i.imgur.com/jGhff4h.png" alt="Outer Shortcut Result on Apple Watch" /></p> <p>I use this Shortcut pretty much every time I leave the house, and it&#39;s saved me from riding up to an empty station more times than I can count. If you&#39;d like to try them out for yourself, here are the iCloud sharing links:</p> <ul> <li><p><a href="https://www.icloud.com/shortcuts/c09620f69b804c62a11f2c8bb4b2b5ef">Get Santander Cycle Feed</a></p> <li><p><a href="https://www.icloud.com/shortcuts/d02693b7d1204478a7cf881c6c4de5db">Check Bikes Example</a></p> </ul> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Jack Shannon. Last modified: October 22, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> </div> <!-- end of class page-wrap--> <script src="/libs/highlight/highlight.min.js"></script>